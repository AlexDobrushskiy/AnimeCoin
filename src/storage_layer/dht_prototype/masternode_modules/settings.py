import os
import hashlib
import json


# CONFIG_FILE_NAME = "masternode.cfg"
# DEFAULT_SETTINGS = {
#     "blockchain": {
#         "rpcuser": "test",
#         "rpcpassword": "testpw",
#         "rpcport": "10340",
#         "port": "12340",
#     }
# }
#
# class MasterNodeConfigParser:
#     def __init__(self, basedir):
#         self.__basedir = basedir
#         self.__configname = os.path.join(self.__basedir, CONFIG_FILE_NAME)
#         self.settings = None
#
#         self.__load_config_file()
#
#     def __load_config_file(self):
#         try:
#             settings = json.load(open(self.__configname))
#         except FileNotFoundError:
#             print("Config file not found, generating a default one")
#             settings = {}
#
#         # set fields from default if they doesn't exist
#         merged_settings = DEFAULT_SETTINGS.copy()
#         for k, v in settings.items():
#             # ignore keys we no longer use
#             if k not in merged_settings:
#                 print("Config key %s is no longer supported!" % k)
#             merged_settings[k] = v
#         self.settings = merged_settings
#         self.save()
#
#     def save(self):
#         json.dump(self.settings, open(self.__configname, "w"), indent=4, sort_keys=True)


# NETWORK SETTINGS - global settings for everyone
class __NetworkSettings:
    pass


NetWorkSettings = __NetworkSettings()

NetWorkSettings.DEBUG = True

NetWorkSettings.ALIAS_SEED = b'd\xad`n\xdc\x89\xc2/\xf6\xcd\xd6\xec\xcc\x1c\xc7\xd4\x83B9\x01\xb4\x06\xa2\xc9=\xf8_\x98\xa1p\x01&'
NetWorkSettings.HASH_ALGO = hashlib.sha256
NetWorkSettings.HEX_DIGEST_SIZE = NetWorkSettings.HASH_ALGO().digest_size * 2
NetWorkSettings.REPLICATION_FACTOR = 15
NetWorkSettings.CHUNKSIZE = 1 * 1024*1024                # 1MB

NetWorkSettings.MAX_TICKET_SIZE = 75 * 1024              # 75kbyte
NetWorkSettings.IMAGE_MAX_SIZE = 100 * 1024*1024         # 100MB
NetWorkSettings.MAX_REGISTRATION_BLOCK_DISTANCE = 3      # 3 blocks

NetWorkSettings.THUMBNAIL_DIMENSIONS = (240, 240)
NetWorkSettings.THUMBNAIL_MAX_SIZE = 100 * 1024          # 100 kb

NetWorkSettings.LUBY_REDUNDANCY_FACTOR = 10


NetWorkSettings.NSFW_MODEL_FILE = "/home/synapse/tmp/animecoin/nsfw/nsfw_trained_model.pb"
if NetWorkSettings.DEBUG:
    NetWorkSettings.NSFW_THRESHOLD = 0.999
else:
    NetWorkSettings.NSFW_THRESHOLD = 0.7

if NetWorkSettings.DEBUG:
    NetWorkSettings.DUPE_DETECTION_MODELS = ["VGG16"]
    NetWorkSettings.DUPE_DETECTION_FINGERPRINT_SIZE = 512
    # NetWorkSettings.DUPE_DETECTION_MODELS = ["VGG16", "Xception", "InceptionResNetV2", "DenseNet201", "InceptionV3"]
    # NetWorkSettings.DUPE_DETECTION_FINGERPRINT_SIZE = 8064
else:
    NetWorkSettings.DUPE_DETECTION_MODELS = ["VGG16", "Xception", "InceptionResNetV2", "DenseNet201", "InceptionV3"]
    NetWorkSettings.DUPE_DETECTION_FINGERPRINT_SIZE = 8064

NetWorkSettings.DUPE_DETECTION_TARGET_SIZE = (240, 240)   # the dupe detection modules were trained with this size
NetWorkSettings.DUPE_DETECTION_SPEARMAN_THRESHOLD = 0.86
NetWorkSettings.DUPE_DETECTION_KENDALL_THRESHOLD = 0.80
NetWorkSettings.DUPE_DETECTION_HOEFFDING_THRESHOLD = 0.48
NetWorkSettings.DUPE_DETECTION_STRICTNESS = 0.99
NetWorkSettings.DUPE_DETECTION_KENDALL_MAX = 0
NetWorkSettings.DUPE_DETECTION_HOEFFDING_MAX = 0

if NetWorkSettings.DEBUG:
    NetWorkSettings.BLOCKCHAIN_SEED_ADDR = "127.0.0.1:12340"
else:
    # TODO: fill this out for prod
    NetWorkSettings.BLOCKCHAIN_SEED_ADDR = ""
NetWorkSettings.BITCOIN_BOOT_WAIT_TIME = 0.5    # time to wait until bitcoind comes up
# END
