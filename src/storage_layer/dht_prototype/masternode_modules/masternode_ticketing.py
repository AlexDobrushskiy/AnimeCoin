from .models_new import RegistrationTicket, Signature

from dht_prototype.masternode_modules.animecoin_modules.animecoin_signatures import\
    animecoin_id_write_signature_on_data_func, animecoin_id_verify_signature_with_public_key_func


def masternode_verify_registration_ticket(signature_regticket, regticket_serialized, blockchain, mn_pub, mn_priv):
    # parse inputs
    signed_regticket = Signature(serialized=signature_regticket)
    regticket = RegistrationTicket(serialized=regticket_serialized)

    # validate client's signature on the ticket
    assert(signed_regticket.pubkey == regticket.author)
    signed_regticket.validate(regticket)

    # validate registration ticket
    regticket.validate(blockchain)

    # sign regticket
    ticket_signed_by_mn = Signature(dictionary={
        "signature": animecoin_id_write_signature_on_data_func(regticket_serialized, mn_priv, mn_pub),
        "pubkey": mn_pub,
    })
    return ticket_signed_by_mn.serialize()


def masternode_place_registration_ticket(signature_regticket, regticket_serialized, mn_pub, mn_priv, blockchain,
                                         masternode_list):
    # parse inputs
    signed_regticket = Signature(serialized=signature_regticket)

    # validate signed ticket
    signed_regticket.validate(regticket_serialized, artist_pubkey)
