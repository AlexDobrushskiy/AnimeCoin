import unittest

from core_modules.rpc_serialization import pack_and_sign, verify_and_unpack


class TestRPCSerialization(unittest.TestCase):
    def setUp(self):
        self.message = ["RPCNAME", "This is some test string"]
        self.receiver_privkey = "C881A6B57DF56F558EDABBC7AA443AEC923C5D086F4FF51DECA26F169DEB3D5078C846120801FF86B37FD98E7E5C47A09920D58E2FD29A3E0B38FD9C274F6E787250DCD9850E9DCE336A40508036E89F9493013E052A3F8B7B800EF584160CB0CAF8B8C3176E0AFE9133C99480E3F94F8CCD637FC0297119A49AF70594C5E03C8C7240C6B9BED86BC3BBAD1C68EDA51A4F009275E582E1F86B24D396C91B9D66DD0689DDE3F3F3B536149B98252AA09D4680F6E9D6E21F2C13433A0D3C0FBB10190776F5F8010C144654A8019A29851B8922B605E17ABDD7D86A6B3F94DBD7C662B45BF43B2DD2E2DE4D32519EAD3E4E19E5F1EDF666BD8613947D53C34AFFA711E978D7DFD6C0CBAAF0441268945A838BFC11069C8FBF8A1C7ACFB5F66DCD065B5016D9C17D643141C424CBA059AD5810F0A1D7EC8D64E739141D74617CE75BB353F31D1254FD386F45DB40899A46D3712D42EC37672EC2894AF44774323FA90BD6677A1008017D6F75D75451D9DF8536FB9BD663456C6225F639B1C5731527EC9995E6EA7A95777EAC7D37BD536E28E65C529DBFE792B762B3AAE059841821ADC6FF8F4E7114BF9D8ECA272409B7CB0A14C2AC11BA5D3B00192D6888CD9BF4C759D70EC9946E5BA8FB47E39EAC364F9BD090EC7CD8E60F0EB959FEF03C9A3D15A7EA8C3E09798AD5DC53D2675D100586E62C768D3978AB946EBE77AAFD27ACAE850C87AFEC9DF744A947530B67D5F056F4B9395A2269F9BB0A7C3B32748381282E9819A930682D7611973400D892BE77F0D8CE2619F5074B42F94F901F3E631F9CF4D680E9E0CC3BD516C7FC5572930CCCB711C6750C4D13FA603EF45F09696D2834F363B8EF34D126F5CA13ED7BA44E3DC3822197723537530936CD17A2D4CB06CAD5401BB16F28A7E99348DCBB7F0ADBD8822872092161D77F31C872C17670F60C572002018BD02CFB3C193402C2DEF7AE145E7B45371014B9F025BED580D253EDACD5A747E66FC2D193F42F03AF64867ABB5D56883A907F712A2EC17994E7467BE4B4C6360D492D5A6D6D376815FE131EB2A952FC1D3A4944A633D1492D254648874A8B43680552939F41027033095A55FB19EF2C89909FD090F7F4D0FAB1E6698FC40A5EBB1C2F6A58D693B1C245BD7615771A71EA4CE6B39848F41EB02256AA07D7FDAD37EE4875AB1D8768BCD95B4E90A1D15B5C1A0E96BA8D56AC757B58C6D8BC90BCA9D7A99C147EED4D263BF6A46A8B554CB630D6008AC5054F669A5A5AACC74452FEDC52F7CC6AF5313E57D94CD0AE6B4E4828592F5AAC9D2673C632E2C6356B2346D998C86E97ED13F98F83006DF9EF0A8DE5FE3F320B4DA8F952310F8BBC1ACE81E7D9088283C9ABCD3F50F5AAFCFA15436BC9482B6484B974B634929EADCE071B03AC62CAF694A486C5ADB14412E3DF99509165279F38E327CF590C4349C4780F7851606B82DBEC3073EF"
        self.receiver_pubkey = "F1F8AD59A97DF9B6D6D1BE759ED2A7A6ADFFC906D89CC0313EF5EA0145E874D81C0EF53C6E1A6146B06E3E0F0DD098022DE1E8DBC4795BED67902DF261A6EA43F280"
        self.sender_privkey = "C74288E982DC5FA445CED27A611E39CB077AF044982C7B571500468EA591714874ADAFC4828563853FFC6122A5A139AAE296EA86CDBE2C4364359394266F62438DC18C87DE0598BFB5B56C3820BECACAA1E6954A359B16E3A342C48E050A9B715D9FE465D3A5499A7B7E8C8C16F946A78901F399CA734FBD7BD060079481B5053505EA1968061615179A099DD7153195E278642CE2A4C9001F98358B151E3A6C4E43276B1BCE56E8EB45A79321EF2FE21989E4CE099EDCEE0169B1B645761E5DEBD68BA46C262F5F610D45394BC1DB2231369D6E0EB188100BCE7713E4CB2A2D994B823F4DBD4FEFFEC291688F07675B960DB906300045A46CD36BE13835413F75FAB868EA90F0E0B17ED5DD301BB430F3201C810AE0084F06021C938754B6C36C689D03DB22BA287DB6E5A0C461BEA4777A7B7996CA64D9019D9F0DAF668FEAC396B4933A78ACC45CF9B43EB5938A31A93DFE2519AE12DD09FD6DA1195581F87AB63A029229AF32EC53444CE531DF2D64763EDBA9E0F66B4F81B3B21B0B9D7524C6DCE689727C4994272FECBD81EBB6D50D6BBEAE9035E6CBFB3D8F9E5068F5A49E140B92EE5262577291DD54828CCE52997D332BB4FDBB79B632EAF37F0CF140344C3D971D9610CEF609D73AC9418DD32D69EC24F835495152286FC46B9B822B6FADAECEE1C39DA0DF6AE2C66588037E7CAE07D36D36C6E04D304B57438FFC491329E30D92C35A7371BDC9088F01AAF3413F3FB0B2DBF299244355E954825BA992CC93EC2D122B939787CA072E1D72FC45B4865868EBF643B488A989FCF1692A4C61A7A1F5FC2B4C3773F070F7343A28353BC9EB619CE5115C4FFCC6AE1B6F24F8A8975923B12ABDEDC0074C360681F78ECCED117B93DB154A4479E781C185E1EDCD1DDB47F237FE3976374C2860150A24E2D192714CE61D10DABE91048E15C7623FB15640D5AC32115CC85A94084EC330B4F31947D207A0ADF8EFAB110E4632CD6FAAF23949D3B0E1B6F2BA8D342AEDCA86C34561390B889D60E1ED12E7001FEE4FB2CD56054DE46013EE3D19A5D91263C9ED8CE51AB9E9188898532D83559A933CF8004BCDDC254320ACCD122948BF5DFC916C2CF7FA9AB48471A10EEE0B472880878032A2A271473E31B464B2AC2C4A7BB40A10019C4B5B037843C0DB07BD5AEBA87E318F6CD4D06456F51FB1BA658B91D9EBA834F611D72B569E1944AC9C8E1B905A2CD5D9C44C258C850D8558953D69F53351C4DD5BDC03E41D58F05CFABF1DA9AECD77F0DDD0839014F0A37601A1F0EEED61752432A71C890A1B3BC4AEEA9F01CF9407AA2E6FCE1980686715A60A30448220D3CA887EC3352CD9684F4E30DFDD65763DD7C2B45484A1AE4DF6C87CA4EA50E474A7F3333543150DF5E5DA0A4E90CEE2B9EE674A6B0D9B63C8B6E9D62F545ED08C65A033FDD59FA6725F9E88F2B6EE6DB0DA72F720967891EF636A4C"
        self.sender_pubkey = "0AB8712A4975F74045F33A5839689EEB8FD68B7FB7CAAFFE784BE7DEA3CCF5F8AC4A5E6377960A5EA4BA638C54CDA3F2ED994A8AE556F1BA450A05C9DC9BDDA67800"

    def test_serialization_and_deserialization(self):
        raw_msg = pack_and_sign(self.sender_privkey, self.sender_pubkey, self.receiver_pubkey, self.message)
        sender_id, data = verify_and_unpack(raw_msg, self.receiver_pubkey)
        self.assertEqual(sender_id, self.sender_pubkey)
        self.assertEqual(data, self.message)
